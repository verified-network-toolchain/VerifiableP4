# How this repository corresponds to the February 2023 paper,
## "Foundational verification of stateful P4 packet processing"

This repository, VerifiableP4, contains the _program logic_ and its demonstration in two examples,
- stateful firewall using sliding-window Bloom filter
- sliding-window count-min-sketch

A different repo, Petr4, contains the syntax, operational semantics, reference interpreter, and OCaml front end.
This commit of VerifiableP4 relies on branch [poulet4](https://github.com/verified-network-toolchain/petr4/tree/poulet4), in particular
tag [Feb2023](https://github.com/verified-network-toolchain/petr4/releases/tag/Feb2023) of that repo, [browsable here](https://github.com/verified-network-toolchain/petr4/tree/b2e78a3a6dd127876acacf111d4caf2262e55b23).

## Concordance between paper and repositories

Paper line#
- line 55 (Spec of firewall) [VerifiableP4/examples/sbf/FlowProperty.v](examples/sbf/FlowProperty.v) and proved in [VerifiableP4/examples/sbf/main_theorem.v](examples/sbf/main_theorem.v)
- line 177 (P4 program for firewall) [VerifiableP4/examples/sbf/stateful.p4](examples/sbf/stateful.p4)
- 182 (packet-level correctness property) [VerifiableP4/examples/sbf/switch.v](examples/sbf/switch.v)
- 188 (ASTs generated by the front end for SBF) [VerifiableP4/examples/sbf/p4ast.v](examples/sbf/p4ast.v)
- Figure 2 (functional model of SBF) [VerifiableP4/examples/sbf/ConFilter.v](examples/sbf/ConFilter.v)
- 204 (Theorem 1) [VerifiableP4/examples/sbf/LightFilter.v](examples/sbf/LightFilter.v)
- Figure 3 (Axioms of SBF) [VerifiableP4/examples/sbf/LightFilter.v](examples/sbf/LightFilter.v)
- Figure 4 (Specification of SBF) [VerifiableP4/examples/sbf/verif_Filter_all.v](examples/sbf/verif_Filter_all.v)
- 234 (Theorem 2) [VerifiableP4/examples/sbf/verif_Filter_all.v](examples/sbf/verif_Filter_all.v)
- 262 (assertions for SBF) [VerifiableP4/examples/sbf/FilterRepr.v](examples/sbf/FilterRepr.v)
- 276 (Petr4 front end) [petr4/lib/exportp4.ml](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/lib/exportp4.ml)
- 278 (decorate names) [petr4/coq/lib/P4light/Transformations/GenLoc.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Transformations/GenLoc.v)
- 283 (unnest expressions) [petr4/coq/lib/P4light/Transformations/SimplExpr.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Transformations/SimplExpr.v)
- 285 (ASTs) [petr4/coq/lib/P4light/Syntax/Syntax.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Syntax/Syntax.v)
- 287 (Operational Semantics) [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 302 (expression judgment) `exec_expr` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 303 (l-expression judgment) `exec_lexpr` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 304 (statement judgment) `exec_stmt` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 305 (call-expression judgment) `exec_call` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 306 (function judgment) `exec_func` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 320 (semantics of undefined values) [petr4/coq/lib/P4light/Syntax/ValueUtil.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Syntax/ValueUtil.v)
- 357 (Reference Interpreter) [petr4/coq/lib/P4light/Semantics/Interpreter.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Interpreter.v)
- 359 (Correctness of the Reference Interpreter) [petr4/coq/lib/P4light/Semantics/InterpreterSafe.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/InterpreterSafe.v)
- 376 (Program Logic) [VerifiableP4/core/Hoare.v](core/Hoare.v) and [VerifiableP4/core/ConcreteHoare.v](core/ConcreteHoare.v)
- 383 (Automation Support) [VerifiableP4/core/Tactics.v](core/Tactics.v)
- 393 (Theorem 3) [VerifiableP4/core/Hoare.v](core/Hoare.v) and [VerifiableP4/core/ConcreteHoare.v](core/ConcreteHoare.v)
- Figure 5 (instantiation) `Section Instantiation` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- 430 (semantics of abstract methods) `Section Instantiation` in [petr4/coq/lib/P4light/Semantics/Semantics.v](https://github.com/verified-network-toolchain/petr4/blob/b2e78a3a6dd127876acacf111d4caf2262e55b23/coq/lib/P4light/Semantics/Semantics.v)
- Table 2 (see note below)
- 451 (count-min-sketch) [VerifiableP4/examples/cms/](examples/cms/)
- Figure 6 (Axioms of CMS) [VerifiableP4/examples/cms/LightModel.v](examples/cms/LightModel.v)

### Pane, Window, Frame
What the paper calls "Pane", the P4 program calls "Window", and the functional model calls "Frame".

### Table 2
- P4 code for Row, Pane, Filter is in [VerifiableP4/examples/sbf/stateful.p4](examples/sbf/stateful.p4)
- Functional model is in [VerifiableP4/examples/sbf/stateful.p4](examples/sbf/stateful.p4), intermixed with some "High-level" proofs about them
- Funcspecs and P4 function-body proofs are in files start with `verif_` in [VerifiableP4/examples/sbf/](examples/sbf/)
- More high-level proofs are in [VerifiableP4/examples/sbf/AbsFilter.v](examples/sbf/AbsFilter.v) and [VerifiableP4/examples/sbf/LightFilter.v](examples/sbf/LightFilter.v)


